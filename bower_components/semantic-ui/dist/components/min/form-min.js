!function($,e,t,n){"use strict";$.fn.form=function(e){var r=$(this),i=r.selector||"",a=(new Date).getTime(),o=[],l=arguments[0],s=arguments[1],c="string"==typeof l,u=[].slice.call(arguments,1),f;return r.each(function(){var d=$(this),p=this,m=[],g=!1,h,v,b,y,x,k,E,w,C,V,R,S,F,A,T,j,z,O;O={initialize:function(){O.get.settings(),c?(z===n&&O.instantiate(),O.invoke(l)):(O.verbose("Initializing form validation",d,w),O.bindEvents(),O.set.defaults(),O.instantiate())},instantiate:function(){O.verbose("Storing instance of module",O),z=O,d.data(T,O)},destroy:function(){O.verbose("Destroying previous module",z),O.removeEvents(),d.removeData(T)},refresh:function(){O.verbose("Refreshing selector cache"),h=d.find(R.field),v=d.find(R.group),b=d.find(R.message),y=d.find(R.prompt),x=d.find(R.submit),k=d.find(R.clear),E=d.find(R.reset)},submit:function(){O.verbose("Submitting form",d),d.submit()},attachEvents:function(e,t){t=t||"submit",$(e).on("click"+j,function(e){O[t](),e.preventDefault()})},bindEvents:function(){O.verbose("Attaching form events"),d.on("submit"+j,O.validate.form).on("blur"+j,R.field,O.event.field.blur).on("click"+j,R.submit,O.submit).on("click"+j,R.reset,O.reset).on("click"+j,R.clear,O.clear),w.keyboardShortcuts&&d.on("keydown"+j,R.field,O.event.field.keydown),h.each(function(){var e=$(this),t=e.prop("type"),n=O.get.changeEvent(t,e);$(this).on(n+j,O.event.field.change)})},clear:function(){h.each(function(){var e=$(this),t=e.parent(),n=e.closest(v),r=n.find(R.prompt),i=e.data(V.defaultValue)||"",a=t.is(R.uiCheckbox),o=t.is(R.uiDropdown),l=n.hasClass(S.error);l&&(O.verbose("Resetting error on field",n),n.removeClass(S.error),r.remove()),o?(O.verbose("Resetting dropdown value",t,i),t.dropdown("clear")):a?e.prop("checked",!1):(O.verbose("Resetting field value",e,i),e.val(""))})},reset:function(){h.each(function(){var e=$(this),t=e.parent(),r=e.closest(v),i=r.find(R.prompt),a=e.data(V.defaultValue),o=t.is(R.uiCheckbox),l=t.is(R.uiDropdown),s=r.hasClass(S.error);a!==n&&(s&&(O.verbose("Resetting error on field",r),r.removeClass(S.error),i.remove()),l?(O.verbose("Resetting dropdown value",t,a),t.dropdown("restore defaults")):o?(O.verbose("Resetting checkbox value",t,a),e.prop("checked",a)):(O.verbose("Resetting field value",e,a),e.val(a)))})},is:{bracketedRule:function(e){return e.type&&e.type.match(w.regExp.bracket)},valid:function(){var e=!0;return O.verbose("Checking if form is valid"),$.each(C,function(t,n){O.validate.field(n,t)||(e=!1)}),e}},removeEvents:function(){d.off(j),h.off(j),x.off(j),h.off(j)},event:{field:{keydown:function(e){var t=$(this),n=e.which,r={enter:13,escape:27};n==r.escape&&(O.verbose("Escape key pressed blurring field"),t.blur()),!e.ctrlKey&&n==r.enter&&t.is(R.input)&&t.not(R.checkbox).length>0&&(g||(t.one("keyup"+j,O.event.field.keyup),O.submit(),O.debug("Enter pressed on input submitting form")),g=!0)},keyup:function(){g=!1},blur:function(e){var t=$(this),n=t.closest(v),r=O.get.validation(t);n.hasClass(S.error)?(O.debug("Revalidating field",t,r),O.validate.form.call(O,e,!0)):"blur"!=w.on&&"change"!=w.on||r&&O.validate.field(r)},change:function(e){var t=$(this),n=t.closest(v);("change"==w.on||n.hasClass(S.error)&&w.revalidate)&&(clearTimeout(O.timer),O.timer=setTimeout(function(){O.debug("Revalidating field",t,O.get.validation(t)),O.validate.form.call(O,e,!0)},w.delay))}}},get:{ancillaryValue:function(e){return e.type&&O.is.bracketedRule(e)?e.type.match(w.regExp.bracket)[1]+"":!1},ruleName:function(e){return O.is.bracketedRule(e)?e.type.replace(e.type.match(w.regExp.bracket)[0],""):e.type},changeEvent:function(e,t){return"checkbox"==e||"radio"==e||"hidden"==e||t.is("select")?"change":O.get.inputEvent()},inputEvent:function(){return t.createElement("input").oninput!==n?"input":t.createElement("input").onpropertychange!==n?"propertychange":"keyup"},prompt:function(e,t){var n=O.get.ruleName(e),r=O.get.ancillaryValue(e),i=e.prompt||w.prompt[n]||w.text.unspecifiedRule,a=-1!==i.search("{value}"),o=-1!==i.search("{name}"),l,s,c;return(o||a)&&(s=O.get.field(t.identifier)),a&&(i=i.replace("{value}",s.val())),o&&(l=s.closest(R.group).find("label").eq(0),c=1==l.size()?l.text():s.prop("placeholder")||w.text.unspecifiedField,i=i.replace("{name}",c)),i=i.replace("{identifier}",t.identifier),i=i.replace("{ruleValue}",r),e.prompt||O.verbose("Using default validation prompt for type",i,n),i},settings:function(){if($.isPlainObject(e)){var t=Object.keys(e),r=t.length>0?e[t[0]].identifier!==n&&e[t[0]].rules!==n:!1,i;r?(w=$.extend(!0,{},$.fn.form.settings,s),C=$.extend({},$.fn.form.settings.defaults,e),O.error(w.error.oldSyntax,p),O.verbose("Extending settings from legacy parameters",C,w)):(e.fields&&(i=Object.keys(e.fields),("string"==typeof e.fields[i[0]]||$.isArray(e.fields[i[0]]))&&$.each(e.fields,function(t,n){"string"==typeof n&&(n=[n]),e.fields[t]={rules:[]},$.each(n,function(n,r){e.fields[t].rules.push({type:r})})})),w=$.extend(!0,{},$.fn.form.settings,e),C=$.extend({},$.fn.form.settings.defaults,w.fields),O.verbose("Extending settings",C,w))}else w=$.fn.form.settings,C=$.fn.form.settings.defaults,O.verbose("Using default form validation",C,w);A=w.namespace,V=w.metadata,R=w.selector,S=w.className,F=w.error,T="module-"+A,j="."+A,z=d.data(T),O.refresh()},field:function(e){return O.verbose("Finding field with identifier",e),h.filter("#"+e).length>0?h.filter("#"+e):h.filter('[name="'+e+'"]').length>0?h.filter('[name="'+e+'"]'):h.filter('[name="'+e+'[]"]').length>0?h.filter('[name="'+e+'[]"]'):h.filter("[data-"+V.validate+'="'+e+'"]').length>0?h.filter("[data-"+V.validate+'="'+e+'"]'):$("<input/>")},fields:function(e){var t=$();return $.each(e,function(e,n){t=t.add(O.get.field(n))}),t},validation:function(e){var t,n;return C?($.each(C,function(r,i){n=i.identifier||r,O.get.field(n)[0]==e[0]&&(i.identifier=n,t=i)}),t||!1):!1},value:function(e){var t=[],n;return t.push(e),n=O.get.values.call(p,t),n[e]},values:function(e){var t=$.isArray(e)?O.get.fields(e):h,n={};return t.each(function(e,t){var r=$(t),i=r.prop("type"),a=r.prop("name"),o=r.val(),l=r.is(R.checkbox),s=r.is(R.radio),c=-1!==a.indexOf("[]"),u=l?r.is(":checked"):!1;a&&(c?(a=a.replace("[]",""),n[a]||(n[a]=[]),l?u?n[a].push(o||!0):n[a].push(!1):n[a].push(o)):s?u&&(n[a]=o):l?u?n[a]=o||!0:n[a]=!1:n[a]=o)}),n}},has:{field:function(e){return O.verbose("Checking for existence of a field with identifier",e),"string"!=typeof e&&O.error(F.identifier,e),h.filter("#"+e).length>0?!0:h.filter('[name="'+e+'"]').length>0?!0:h.filter("[data-"+V.validate+'="'+e+'"]').length>0}},add:{prompt:function(e,t){var r=O.get.field(e),i=r.closest(v),a=i.children(R.prompt),o=0!==a.length;t="string"==typeof t?[t]:t,O.verbose("Adding field error state",e),i.addClass(S.error),w.inline&&(o||(a=w.templates.prompt(t),a.appendTo(i)),a.html(t[0]),o?O.verbose("Inline errors are disabled, no inline error added",e):w.transition&&$.fn.transition!==n&&d.transition("is supported")?(O.verbose("Displaying error with css transition",w.transition),a.transition(w.transition+" in",w.duration)):(O.verbose("Displaying error with fallback javascript animation"),a.fadeIn(w.duration)))},errors:function(e){O.debug("Adding form error messages",e),O.set.error(),b.html(w.templates.error(e))}},remove:{prompt:function(e){var t=O.get.field(e),r=t.closest(v),i=r.children(R.prompt);r.removeClass(S.error),w.inline&&i.is(":visible")&&(O.verbose("Removing prompt for field",e),w.transition&&$.fn.transition!==n&&d.transition("is supported")?i.transition(w.transition+" out",w.duration,function(){i.remove()}):i.fadeOut(w.duration,function(){i.remove()}))}},set:{success:function(){d.removeClass(S.error).addClass(S.success)},defaults:function(){h.each(function(){var e=$(this),t=e.filter(R.checkbox).length>0,n=t?e.is(":checked"):e.val();e.data(V.defaultValue,n)})},error:function(){d.removeClass(S.success).addClass(S.error)},value:function(e,t){var n={};return n[e]=t,O.set.values.call(p,n)},values:function(e){$.isEmptyObject(e)||$.each(e,function(e,t){var n=O.get.field(e),r=n.parent(),i=$.isArray(t),a=r.is(R.uiCheckbox),o=r.is(R.uiDropdown),l=n.is(R.radio)&&a,s=n.length>0,c;s&&(i&&a?(O.verbose("Selecting multiple",t,n),r.checkbox("uncheck"),$.each(t,function(e,t){c=n.filter('[value="'+t+'"]'),r=c.parent(),c.length>0&&r.checkbox("check")})):l?(O.verbose("Selecting radio value",t,n),n.filter('[value="'+t+'"]').parent(R.uiCheckbox).checkbox("check")):a?(O.verbose("Setting checkbox value",t,r),t===!0?r.checkbox("check"):r.checkbox("uncheck")):o?(O.verbose("Setting dropdown value",t,r),r.dropdown("set selected",t)):(O.verbose("Setting field value",t,n),n.val(t)))})}},validate:{form:function(e,t){var r=O.get.values(),i;if(g)return!1;if(m=[],O.is.valid()){if(O.debug("Form has no validation errors, submitting"),O.set.success(),t!==!0)return w.onSuccess.call(p,e,r)}else if(O.debug("Form has errors"),O.set.error(),w.inline||O.add.errors(m),d.data("moduleApi")!==n&&e.stopImmediatePropagation(),t!==!0)return w.onFailure.call(p,m,r)},field:function(e,t){var r=e.identifier||t,i=O.get.field(r),a=!0,o=[];return e.identifier||(O.debug("Using field name as identifier",r),e.identifier=r),i.prop("disabled")?(O.debug("Field is disabled. Skipping",r),a=!0):e.optional&&""===$.trim(i.val())?(O.debug("Field is optional and empty. Skipping",r),a=!0):e.rules!==n&&$.each(e.rules,function(t,n){O.has.field(r)&&!O.validate.rule(e,n)&&(O.debug("Field is invalid",r,n.type),o.push(O.get.prompt(n,e)),a=!1)}),a?(O.remove.prompt(r,o),w.onValid.call(i),!0):(m=m.concat(o),O.add.prompt(r,o),w.onInvalid.call(i,o),!1)},rule:function(e,t){var r=O.get.field(e.identifier),i=t.type,a=r.val(),o=!0,l=O.get.ancillaryValue(t),s=O.get.ruleName(t),c=w.rules[s];return $.isFunction(c)?(a=a===n||""===a||null===a?"":$.trim(a+""),c.call(r,a,l)):void O.error(F.noRule,s)}},setting:function(e,t){if($.isPlainObject(e))$.extend(!0,w,e);else{if(t===n)return w[e];w[e]=t}},internal:function(e,t){if($.isPlainObject(e))$.extend(!0,O,e);else{if(t===n)return O[e];O[e]=t}},debug:function(){w.debug&&(w.performance?O.performance.log(arguments):(O.debug=Function.prototype.bind.call(console.info,console,w.name+":"),O.debug.apply(console,arguments)))},verbose:function(){w.verbose&&w.debug&&(w.performance?O.performance.log(arguments):(O.verbose=Function.prototype.bind.call(console.info,console,w.name+":"),O.verbose.apply(console,arguments)))},error:function(){O.error=Function.prototype.bind.call(console.error,console,w.name+":"),O.error.apply(console,arguments)},performance:{log:function(e){var t,n,r;w.performance&&(t=(new Date).getTime(),r=a||t,n=t-r,a=t,o.push({Name:e[0],Arguments:[].slice.call(e,1)||"",Element:p,"Execution Time":n})),clearTimeout(O.performance.timer),O.performance.timer=setTimeout(O.performance.display,500)},display:function(){var e=w.name+":",t=0;a=!1,clearTimeout(O.performance.timer),$.each(o,function(e,n){t+=n["Execution Time"]}),e+=" "+t+"ms",i&&(e+=" '"+i+"'"),r.length>1&&(e+=" ("+r.length+")"),(console.group!==n||console.table!==n)&&o.length>0&&(console.groupCollapsed(e),console.table?console.table(o):$.each(o,function(e,t){console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.groupEnd()),o=[]}},invoke:function(e,t,r){var i=z,a,o,l;return t=t||u,r=p||r,"string"==typeof e&&i!==n&&(e=e.split(/[\. ]/),a=e.length-1,$.each(e,function(t,r){var l=t!=a?r+e[t+1].charAt(0).toUpperCase()+e[t+1].slice(1):e;if($.isPlainObject(i[l])&&t!=a)i=i[l];else{if(i[l]!==n)return o=i[l],!1;if(!$.isPlainObject(i[r])||t==a)return i[r]!==n?(o=i[r],!1):!1;i=i[r]}})),$.isFunction(o)?l=o.apply(r,t):o!==n&&(l=o),$.isArray(f)?f.push(l):f!==n?f=[f,l]:l!==n&&(f=l),o}},O.initialize()}),f!==n?f:this},$.fn.form.settings={name:"Form",namespace:"form",debug:!1,verbose:!1,performance:!0,fields:!1,keyboardShortcuts:!0,on:"submit",inline:!1,delay:200,revalidate:!0,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,decimal:/^\d*(\.)\d+/,email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,flags:/^\/(.*)\/(.*)?/,integer:/^\-?\d+$/,number:/^\-?\d*(\.\d+)?$/,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i},text:{unspecifiedRule:"Please enter a valid value",unspecifiedField:"This field"},prompt:{empty:"{name} must have a value",checked:"{name} must be checked",email:"{name} must be a valid e-mail",url:"{name} must be a valid url",regExp:"{name} is not formatted correctly",integer:"{name} must be an integer",decimal:"{name} must be a decimal number",number:"{name} must be set to a number",is:'{name} must be "{ruleValue}"',isExactly:'{name} must be exactly "{ruleValue}"',not:'{name} cannot be set to "{ruleValue}"',notExactly:'{name} cannot be set to exactly "{ruleValue}"',contain:'{name} cannot contain "{ruleValue}"',containExactly:'{name} cannot contain exactly "{ruleValue}"',doesntContain:'{name} must contain  "{ruleValue}"',doesntContainExactly:'{name} must contain exactly "{ruleValue}"',minLength:"{name} must be at least {ruleValue} characters",length:"{name} must be at least {ruleValue} characters",exactLength:"{name} must be exactly {ruleValue} characters",maxLength:"{name} cannot be longer than {ruleValue} characters",match:"{name} must match {ruleValue} field",different:"{name} must have a different value than {ruleValue} field",creditCard:"{name} must be a valid credit card number",minCount:"{name} must have at least {ruleValue} choices",exactCount:"{name} must have exactly {ruleValue} choices",maxCount:"{name} must have {ruleValue} or less choices"},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{identifier:"You must specify a string identifier for each field",method:"The method you called is not defined.",noRule:"There is no rule matching the one you specified",oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically."},templates:{error:function(e){var t='<ul class="list">';return $.each(e,function(e,n){t+="<li>"+n+"</li>"}),t+="</ul>",$(t)},prompt:function(e){return $("<div/>").addClass("ui basic red pointing prompt label").html(e[0])}},rules:{empty:function(e){return!(e===n||""===e||$.isArray(e)&&0===e.length)},checked:function(){return $(this).filter(":checked").length>0},email:function(e){var t=new RegExp($.fn.form.settings.regExp.email,"i");return t.test(e)},url:function(e){return $.fn.form.settings.regExp.url.test(e)},regExp:function(e,t){var n=t.match($.fn.form.settings.regExp.flags),r;return n&&(t=n.length>=2?n[1]:t,r=n.length>=3?n[2]:""),e.match(new RegExp(t,r))},integer:function(e,t){var r=$.fn.form.settings.regExp.integer,i,a,o;return t&&-1===["",".."].indexOf(t)&&(-1==t.indexOf("..")?r.test(t)&&(i=a=t-0):(o=t.split("..",2),r.test(o[0])&&(i=o[0]-0),r.test(o[1])&&(a=o[1]-0))),r.test(e)&&(i===n||e>=i)&&(a===n||a>=e)},decimal:function(e){return $.fn.form.settings.regExp.decimal.test(e)},number:function(e){return $.fn.form.settings.regExp.number.test(e)},is:function(e,t){return t="string"==typeof t?t.toLowerCase():t,e="string"==typeof e?e.toLowerCase():e,e==t},isExactly:function(e,t){return e==t},not:function(e,t){return e="string"==typeof e?e.toLowerCase():e,t="string"==typeof t?t.toLowerCase():t,e!=t},notExactly:function(e,t){return e!=t},contains:function(e,t){return t=t.replace($.fn.form.settings.regExp.escape,"\\$&"),-1!==e.search(new RegExp(t,"i"))},containsExactly:function(e,t){return t=t.replace($.fn.form.settings.regExp.escape,"\\$&"),-1!==e.search(new RegExp(t))},doesntContain:function(e,t){return t=t.replace($.fn.form.settings.regExp.escape,"\\$&"),-1===e.search(new RegExp(t,"i"))},doesntContainExactly:function(e,t){return t=t.replace($.fn.form.settings.regExp.escape,"\\$&"),-1===e.search(new RegExp(t))},minLength:function(e,t){return e!==n?e.length>=t:!1},length:function(e,t){return e!==n?e.length>=t:!1},exactLength:function(e,t){return e!==n?e.length==t:!1},maxLength:function(e,t){return e!==n?e.length<=t:!1},match:function(e,t){var r=$(this),i;return $('[data-validate="'+t+'"]').length>0?i=$('[data-validate="'+t+'"]').val():$("#"+t).length>0?i=$("#"+t).val():$('[name="'+t+'"]').length>0?i=$('[name="'+t+'"]').val():$('[name="'+t+'[]"]').length>0&&(i=$('[name="'+t+'[]"]')),i!==n?e.toString()==i.toString():!1},different:function(e,t){var r=$(this),i;return $('[data-validate="'+t+'"]').length>0?i=$('[data-validate="'+t+'"]').val():$("#"+t).length>0?i=$("#"+t).val():$('[name="'+t+'"]').length>0?i=$('[name="'+t+'"]').val():$('[name="'+t+'[]"]').length>0&&(i=$('[name="'+t+'[]"]')),i!==n?e.toString()!==i.toString():!1},creditCard:function(e,t){var n={visa:{pattern:/^4/,length:[16]},amex:{pattern:/^3[47]/,length:[15]},mastercard:{pattern:/^5[1-5]/,length:[16]},discover:{pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,length:[16]},unionPay:{pattern:/^(62|88)/,length:[16,17,18,19]},jcb:{pattern:/^35(2[89]|[3-8][0-9])/,length:[16]},maestro:{pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,length:[12,13,14,15,16,17,18,19]},dinersClub:{pattern:/^(30[0-5]|^36)/,length:[14]},laser:{pattern:/^(6304|670[69]|6771)/,length:[16,17,18,19]},visaElectron:{pattern:/^(4026|417500|4508|4844|491(3|7))/,length:[16]}},r={},i=!1,a="string"==typeof t?t.split(","):!1,o,l;if("string"==typeof e&&0!==e.length){if(a&&($.each(a,function(t,a){l=n[a],l&&(r={length:-1!==$.inArray(e.length,l.length),pattern:-1!==e.search(l.pattern)},r.length&&r.pattern&&(i=!0))}),!i))return!1;if(o={number:-1!==$.inArray(e.length,n.unionPay.length),pattern:-1!==e.search(n.unionPay.pattern)},o.number&&o.pattern)return!0;for(var s=e.length,c=0,u=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],f=0;s--;)f+=u[c][parseInt(e.charAt(s),10)],c^=1;return f%10===0&&f>0}},minCount:function(e,t){return 0==t?!0:1==t?""!==e:e.split(",").length>=t},exactCount:function(e,t){return 0==t?""===e:1==t?""!==e&&-1===e.search(","):e.split(",").length==t},maxCount:function(e,t){return 0==t?!1:1==t?-1===e.search(","):e.split(",").length<=t}}}}(jQuery,window,document);